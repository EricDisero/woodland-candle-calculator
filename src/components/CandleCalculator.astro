---
// Candle Calculator Component
---

<div class="min-h-screen py-8 px-4">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="flex flex-col items-center gap-2">
        <!-- Large centered logo -->
        <img src="/logo.svg" alt="Woodland Candle Logo" width="120" height="120" class="mx-auto" />
        <!-- Calculator text in bold -->
        <h1 class="text-xl lg:text-3xl font-black text-black tracking-wide">Recipe Calculator</h1>
      </div>
    </div>

    <div class="grid lg:grid-cols-2 gap-8">
      <!-- Input Section -->
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/50 p-8">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
          <svg class="w-6 h-6 text-[#a5b79b]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg>
          Input Details
        </h2>

        <div class="space-y-6">
          <!-- Container Type and Quantity -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Container Type
                <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="Jug makes 8 candles (1880g), 8oz jar is individual (235g)">?</span>
              </label>
              <select 
                id="containerType"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
              >
                <option value="jug">Jug (8 candles)</option>
                <option value="jar">8oz Jar (individual)</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Quantity
                <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="Number of jugs or individual jars to make">?</span>
              </label>
              <input 
                type="number" 
                id="containerQuantity"
                value="1"
                min="1"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
                placeholder="1"
              />
            </div>
          </div>

          <!-- Total Water Capacity Display -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Total Water Capacity
              <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="Automatically calculated based on container type and quantity">?</span>
            </label>
            <div class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-700 font-medium">
              <span id="totalWaterCapacity">1880g</span>
              <span id="containerInfo" class="text-sm text-gray-500 ml-2">(1 jug = 8 candles)</span>
            </div>
          </div>

          <!-- Wax Type Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Wax Type
              <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="Select your wax type for automatic gravity and temperature settings">?</span>
            </label>
            <select 
              id="waxType"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
            >
              <option value="464">464 Soy Wax (Default)</option>
              <option value="coconut">Coconut Wax</option>
              <option value="beeswax">Beeswax</option>
              <option value="paraffin">Paraffin Wax</option>
              <option value="custom">Custom</option>
            </select>
          </div>

          <!-- Wax Gravity -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Wax Gravity
              <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="Weight of wax divided by the weight of water">?</span>
            </label>
            <input 
              type="number" 
              id="waxGravity"
              value="0.92"
              step="0.01"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
              placeholder="0.92"
            />
          </div>

          <!-- Scent Load -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Scent Load (%)
              <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="How smelly do you want the candles?">?</span>
            </label>
            <input 
              type="number" 
              id="scentLoad"
              value="8"
              max="100"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
              placeholder="8"
            />
          </div>

          <!-- Recipe Presets -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Sarah's Recipe Presets
              <span class="tooltip-trigger inline-flex items-center justify-center w-4 h-4 ml-1 text-xs bg-gray-300 text-gray-600 rounded-full cursor-help" data-tooltip="Load one of Sarah's signature woodland candle recipes">?</span>
            </label>
            <select 
              id="recipePresets"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
            >
              <option value="">Select a preset recipe...</option>
              <option value="log-cabin">Log Cabin</option>
              <option value="old-growth">Old Growth</option>
              <option value="in-the-pines">In The Pines</option>
              <option value="douglas-fir">Douglas Fir</option>
              <option value="arbutus">Arbutus</option>
            </select>
          </div>

          <!-- Fragrance Recipe -->
          <div>
            <h3 class="text-lg font-medium text-gray-800 mb-4">Fragrance Recipe</h3>
            <div id="fragranceInputs" class="space-y-4">
              <div class="fragrance-input flex gap-3 items-end">
                <div class="flex-1">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Fragrance Oil 1 (%)</label>
                  <input 
                    type="number" 
                    class="fragrance-percentage w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
                    max="100"
                    placeholder="0"
                  />
                </div>
                <div class="flex-1">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Name (optional)</label>
                  <input 
                    type="text" 
                    class="fragrance-name w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
                    placeholder="Vanilla"
                  />
                </div>
                <button type="button" class="remove-fragrance p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors duration-200 hidden">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </button>
              </div>
            </div>
            
            <button 
              type="button" 
              id="addFragrance"
              class="mt-4 flex items-center gap-2 px-4 py-2 text-[#a5b79b] hover:bg-[#a5b79b] hover:text-white border border-[#a5b79b] rounded-lg transition-all duration-200"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Add Fragrance Oil
            </button>

            <div id="totalPercentage" class="mt-4 p-3 rounded-lg bg-gray-50 text-sm">
              <span class="font-medium">Total Percentage: </span>
              <span id="totalPercent">0</span>%
              <span id="percentageWarning" class="text-red-600 ml-2 hidden">⚠️ Total should equal 100%</span>
            </div>
          </div>

          <button 
            type="button" 
            id="calculateBtn"
            class="w-full bg-[#a5b79b] hover:bg-[#7a9173] text-white font-bold py-5 px-8 rounded-xl transition-all duration-300 shadow-xl hover:shadow-2xl transform hover:-translate-y-1 active:scale-95"
          >
            <span class="text-lg font-bold text-white tracking-wide text-center">Calculate Recipe</span>
          </button>
        </div>
      </div>

      <!-- Results Section -->
      <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl border border-white/50 p-8">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
          <svg class="w-6 h-6 text-[#a5b79b]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          Calculated Weights
        </h2>

        <div id="resultsContainer" class="space-y-4">
          <div class="text-center py-12 text-gray-500">
            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.05-7.44 7-7.93v15.86zm2-15.86c3.94.49 7 3.85 7 7.93s-3.05 7.44-7 7.93V4.07z"/>
            </svg>
            <p class="text-lg">Complete the form to see your results</p>
            <p class="text-sm mt-2">Enter your jar capacity, wax gravity, scent load, and fragrance percentages</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center mt-12 text-gray-600">
      <p class="text-sm">
        Input jar/melting pot capacity, wax gravity, scent load, and oil percentages. The calculator will determine accurate wax and oil weights for your candles.
      </p>
      <p class="text-xs mt-2 text-gray-500">
        Ensure total oil percentages equal 100% for best results.
      </p>
    </div>
  </div>
</div>

<script>
  let fragranceCount = 1;
  
  // Wax type data with properties
  interface WaxData {
    gravity: number;
    meltTemp: number;
    mixTemp: number;
    pourTemp: number;
  }

  interface FragranceData {
    name: string;
    percentage: number;
    weight?: number;
  }

  interface RecipePreset {
    name: string;
    fragrances: FragranceData[];
  }

  const waxTypes: Record<string, WaxData> = {
    '464': { gravity: 0.92, meltTemp: 185, mixTemp: 155, pourTemp: 135 },
    'coconut': { gravity: 0.94, meltTemp: 175, mixTemp: 180, pourTemp: 145 },
    'beeswax': { gravity: 0.96, meltTemp: 145, mixTemp: 150, pourTemp: 140 },
    'paraffin': { gravity: 0.90, meltTemp: 140, mixTemp: 145, pourTemp: 135 },
    'custom': { gravity: 0.92, meltTemp: 185, mixTemp: 155, pourTemp: 135 }
  };

  // Container types with their water capacities
  const containerTypes: Record<string, { waterCapacity: number; description: string }> = {
    'jug': { waterCapacity: 1880, description: 'jug = 8 candles' },
    'jar': { waterCapacity: 235, description: '8oz jar' }
  };

  // Recipe presets
  const recipePresets: Record<string, RecipePreset> = {
    'log-cabin': {
      name: 'Log Cabin',
      fragrances: [
        { name: 'Cozy Cabin FO', percentage: 55 },
        { name: 'Cedarwood Virginia EO', percentage: 40 },
        { name: 'Firewood FO', percentage: 5 }
      ]
    },
    'old-growth': {
      name: 'Old Growth',
      fragrances: [
        { name: 'Woods & Earth FO', percentage: 40 },
        { name: 'Patchouli EO', percentage: 10 },
        { name: 'Cedarwood Virginia EO', percentage: 30 },
        { name: 'Fir Balsam EO', percentage: 20 }
      ]
    },
    'in-the-pines': {
      name: 'In The Pines',
      fragrances: [
        { name: 'Evergreen FO', percentage: 50 },
        { name: 'Pine Scotch EO', percentage: 50 }
      ]
    },
    'douglas-fir': {
      name: 'Douglas Fir',
      fragrances: [
        { name: 'Cedarwood Virginia EO', percentage: 24 },
        { name: 'Balsam Fir FO', percentage: 40 },
        { name: 'Fir Needle EO', percentage: 36 }
      ]
    },
    'arbutus': {
      name: 'Arbutus',
      fragrances: [
        { name: 'Cedarwood Virginia EO', percentage: 20 },
        { name: 'Bourbon Sandalwood FO', percentage: 80 }
      ]
    }
  };

  function updateWaxProperties(): void {
    const waxType = (document.getElementById('waxType') as HTMLSelectElement)?.value || '464';
    const waxGravityInput = document.getElementById('waxGravity') as HTMLInputElement;
    
    if (waxGravityInput && waxTypes[waxType]) {
      waxGravityInput.value = waxTypes[waxType].gravity.toString();
    }
    
    // Auto-calculate when wax type changes
    calculateRecipe();
  }

  function loadRecipePreset(): void {
    const presetValue = (document.getElementById('recipePresets') as HTMLSelectElement)?.value;
    if (!presetValue || !recipePresets[presetValue]) return;

    const preset = recipePresets[presetValue];
    const container = document.getElementById('fragranceInputs');
    if (!container) return;

    // Clear existing inputs
    container.innerHTML = '';
    fragranceCount = 0;

    // Add preset fragrances
    preset.fragrances.forEach((fragrance: FragranceData) => {
      addFragranceInput(fragrance.name, fragrance.percentage.toString());
    });

    updateTotalPercentage();
    // Auto-calculate when preset is loaded
    calculateRecipe();
  }

  function updateWaterCapacity(): void {
    const containerType = (document.getElementById('containerType') as HTMLSelectElement)?.value || 'jug';
    const quantity = parseInt((document.getElementById('containerQuantity') as HTMLInputElement)?.value) || 1;
    
    const containerData = containerTypes[containerType];
    const totalCapacity = containerData.waterCapacity * quantity;
    
    const capacityDisplay = document.getElementById('totalWaterCapacity');
    const infoDisplay = document.getElementById('containerInfo');
    
    if (capacityDisplay) {
      capacityDisplay.textContent = `${totalCapacity}g`;
    }
    
    if (infoDisplay) {
      if (containerType === 'jug') {
        infoDisplay.textContent = `(${quantity} ${quantity === 1 ? 'jug' : 'jugs'} = ${quantity * 8} candles)`;
      } else {
        infoDisplay.textContent = `(${quantity} ${quantity === 1 ? '8oz jar' : '8oz jars'})`;
      }
    }
    
    // Auto-calculate when capacity changes
    calculateRecipe();
  }

  function updateFragranceNumbers(): void {
    const inputs = document.querySelectorAll('.fragrance-input');
    inputs.forEach((input, index: number) => {
      const label = input.querySelector('label');
      if (label) {
        label.textContent = `Fragrance Oil ${index + 1} (%)`;
      }
      
      // Show/hide remove button
      const removeBtn = input.querySelector('.remove-fragrance');
      if (removeBtn) {
        removeBtn.classList.toggle('hidden', inputs.length <= 1);
      }
    });
  }

  function updateTotalPercentage(): void {
    const percentageInputs = document.querySelectorAll('.fragrance-percentage') as NodeListOf<HTMLInputElement>;
    let total = 0;
    
    percentageInputs.forEach((input: HTMLInputElement) => {
      const value = parseFloat(input.value) || 0;
      total += value;
    });
    
    const totalSpan = document.getElementById('totalPercent');
    const warningSpan = document.getElementById('percentageWarning');
    
    if (totalSpan) {
      totalSpan.textContent = total.toFixed(1);
    }
    
    if (warningSpan) {
      if (total !== 100 && total > 0) {
        warningSpan.classList.remove('hidden');
      } else {
        warningSpan.classList.add('hidden');
      }
    }
    
    // Auto-calculate when percentages change
    calculateRecipe();
  }

  function addFragranceInput(defaultName: string = '', defaultPercentage: string = ''): void {
    fragranceCount++;
    const container = document.getElementById('fragranceInputs');
    if (!container) return;

    const newInput = document.createElement('div');
    newInput.className = 'fragrance-input flex gap-3 items-end';
    newInput.innerHTML = `
      <div class="flex-1">
        <label class="block text-sm font-medium text-gray-700 mb-2">Fragrance Oil ${fragranceCount} (%)</label>
        <input 
          type="number" 
          class="fragrance-percentage w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
          max="100"
          placeholder="0"
          value="${defaultPercentage}"
        />
      </div>
      <div class="flex-1">
        <label class="block text-sm font-medium text-gray-700 mb-2">Name (optional)</label>
        <input 
          type="text" 
          class="fragrance-name w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a5b79b] focus:border-transparent transition-all duration-200 bg-white/50"
          placeholder="Essential Oil"
          value="${defaultName}"
        />
      </div>
      <button type="button" class="remove-fragrance p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors duration-200">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
      </button>
    `;

    container.appendChild(newInput);
    updateFragranceNumbers();
    
    // Add event listeners to new inputs
    const percentageInput = newInput.querySelector('.fragrance-percentage') as HTMLInputElement;
    const removeBtn = newInput.querySelector('.remove-fragrance') as HTMLButtonElement;
    
    if (percentageInput) {
      percentageInput.addEventListener('input', updateTotalPercentage);
    }
    
    if (removeBtn) {
      removeBtn.addEventListener('click', () => {
        newInput.remove();
        updateFragranceNumbers();
        updateTotalPercentage();
      });
    }
  }

  function calculateRecipe(): void {
    // Calculate total water capacity from container selection
    const containerType = (document.getElementById('containerType') as HTMLSelectElement)?.value || 'jug';
    const quantity = parseInt((document.getElementById('containerQuantity') as HTMLInputElement)?.value) || 1;
    const containerData = containerTypes[containerType];
    const jarCapacity = containerData.waterCapacity * quantity;
    
    const waxGravity = parseFloat((document.getElementById('waxGravity') as HTMLInputElement)?.value) || 0.92;
    const scentLoad = parseFloat((document.getElementById('scentLoad') as HTMLInputElement)?.value) || 8;
    const waxType = (document.getElementById('waxType') as HTMLSelectElement)?.value || '464';
    
    // Calculate "wax-only fill" - the maximum weight of pure wax that would fill the jar
    const waxFill = jarCapacity * waxGravity;
    
    // Convert scent load percentage to decimal
    const scentLoadDecimal = scentLoad / 100;
    
    // Back-calculate actual wax weight so that wax + fragrance = wax-fill capacity
    // Formula: wax_weight = wax_fill / (1 + scent_load_decimal)
    const waxWeight = waxFill / (1 + scentLoadDecimal);
    
    // Calculate total fragrance weight
    const totalFragranceWeight = waxWeight * scentLoadDecimal;
    
    // Get fragrance percentages
    const fragranceInputs = document.querySelectorAll('.fragrance-input');
    const fragrances: FragranceData[] = [];
    
    fragranceInputs.forEach((input, index: number) => {
      const percentage = parseFloat((input.querySelector('.fragrance-percentage') as HTMLInputElement)?.value) || 0;
      const name = (input.querySelector('.fragrance-name') as HTMLInputElement)?.value || `Fragrance Oil ${index + 1}`;
      
      if (percentage > 0) {
        const weight = (totalFragranceWeight * percentage) / 100;
        fragrances.push({ name, percentage, weight });
      }
    });
    
    // Display results
    displayResults(waxWeight, totalFragranceWeight, fragrances, jarCapacity, waxType, waxFill, containerType, quantity);
  }

  function displayResults(waxWeight: number, totalFragranceWeight: number, fragrances: FragranceData[], jarCapacity: number, waxType: string, waxFill: number, containerType: string, quantity: number): void {
    const container = document.getElementById('resultsContainer');
    if (!container) return;

    const totalWeight = waxWeight + totalFragranceWeight;
    const waxData = waxTypes[waxType] || waxTypes['464'];
    const containerData = containerTypes[containerType];
    
    // Calculate individual container amounts if making multiple
    const individualWaxWeight = waxWeight / quantity;
    const individualFragranceWeight = totalFragranceWeight / quantity;
    const individualTotalWeight = totalWeight / quantity;
    
    container.innerHTML = `
      <div class="space-y-6">
        <!-- Summary Card -->
        <div class="bg-gradient-to-r from-[#a5b79b]/10 to-[#7a9173]/10 rounded-xl p-6 border border-[#a5b79b]/20">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Recipe Summary</h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-[#a5b79b]">${waxWeight.toFixed(1)}g</div>
              <div class="text-sm text-gray-600">Total Wax Weight</div>
              ${quantity > 1 ? `<div class="text-xs text-gray-500">${individualWaxWeight.toFixed(1)}g per ${containerData.description}</div>` : ''}
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-[#7a9173]">${totalFragranceWeight.toFixed(1)}g</div>
              <div class="text-sm text-gray-600">Total Fragrance</div>
              ${quantity > 1 ? `<div class="text-xs text-gray-500">${individualFragranceWeight.toFixed(1)}g per ${containerData.description}</div>` : ''}
            </div>
          </div>
          <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="text-center">
              <div class="text-lg font-semibold text-gray-800">${totalWeight.toFixed(1)}g</div>
              <div class="text-sm text-gray-600">Total Recipe Weight</div>
              ${quantity > 1 ? `<div class="text-xs text-gray-500">${individualTotalWeight.toFixed(1)}g per ${containerData.description}</div>` : ''}
              <div class="text-xs text-gray-500 mt-1">Volume-locked to ${quantity} ${quantity === 1 ? containerData.description : containerData.description + 's'} (${waxFill.toFixed(1)}g capacity)</div>
            </div>
          </div>
        </div>

        <!-- Fragrance Breakdown -->
        ${fragrances.length > 0 ? `
          <div>
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Fragrance Breakdown</h3>
            <div class="space-y-3">
              ${fragrances.map((fragrance: FragranceData, index: number) => `
                <div class="bg-white/60 rounded-lg p-4 border border-gray-200 flex justify-between items-center">
                  <div>
                    <div class="font-medium text-gray-800">${fragrance.name}</div>
                    <div class="text-sm text-gray-600">${fragrance.percentage}% of fragrance</div>
                  </div>
                  <div class="text-right">
                    <div class="text-lg font-semibold text-[#a5b79b]">${fragrance.weight?.toFixed(2)}g</div>
                    <div class="text-xs text-gray-500">${((fragrance.weight! / totalWeight) * 100).toFixed(1)}% of total</div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        ` : ''}

        <!-- Temperature Guidelines -->
        <div class="bg-amber-50 rounded-xl p-6 border border-amber-200">
          <h3 class="text-lg font-semibold text-amber-800 mb-4">Temperature Guidelines</h3>
          <div class="grid grid-cols-3 gap-4">
            <div class="text-center">
              <div class="text-xl font-bold text-amber-700">${waxData.meltTemp}°F</div>
              <div class="text-sm text-amber-600">Melting</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-amber-700">${waxData.mixTemp}°F</div>
              <div class="text-sm text-amber-600">Mixing</div>
            </div>
            <div class="text-center">
              <div class="text-xl font-bold text-amber-700">${waxData.pourTemp}°F</div>
              <div class="text-sm text-amber-600">Pouring</div>
            </div>
          </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
          <h3 class="text-sm font-semibold text-blue-800 mb-2">Sarah's Wax Melter Instructions</h3>
          <ol class="text-sm text-blue-700 space-y-1 list-decimal list-inside">
            <li>Melt all wax in wax melter to ${waxData.meltTemp}°F</li>
            <li>Pre-mix all fragrance oils together in a separate container:</li>
            <ul class="text-sm text-blue-600 ml-4 mt-1 space-y-0.5 list-disc list-inside">
              ${fragrances.map((f: FragranceData) => `<li>${f.weight?.toFixed(2)}g of ${f.name}</li>`).join('')}
            </ul>
            <li>Pour melted wax into mixing pitcher to measure ${waxWeight.toFixed(1)}g</li>
            <li>Wait for pitcher to reach ${waxData.mixTemp}°F</li>
            <li>Add entire fragrance mixture (${totalFragranceWeight.toFixed(1)}g total) to pitcher</li>
            <li>Mix oils into wax very well (2-3 minutes)</li>
            <li>Wait for pitcher to cool to ${waxData.pourTemp}°F</li>
            <li>Transfer wax from pitcher to wax dispenser</li>
            <li>Pour candles and allow to cure for 24-48 hours</li>
          </ol>
        </div>
      </div>
    `;
  }

  // Initialize event listeners
  document.addEventListener('DOMContentLoaded', () => {
    const addBtn = document.getElementById('addFragrance') as HTMLButtonElement;
    const calculateBtn = document.getElementById('calculateBtn') as HTMLButtonElement;
    const waxTypeSelect = document.getElementById('waxType') as HTMLSelectElement;
    const recipePresetsSelect = document.getElementById('recipePresets') as HTMLSelectElement;
    const containerTypeSelect = document.getElementById('containerType') as HTMLSelectElement;
    const containerQuantityInput = document.getElementById('containerQuantity') as HTMLInputElement;
    const waxGravityInput = document.getElementById('waxGravity') as HTMLInputElement;
    const scentLoadInput = document.getElementById('scentLoad') as HTMLInputElement;
    const initialPercentageInput = document.querySelector('.fragrance-percentage') as HTMLInputElement;
    const initialRemoveBtn = document.querySelector('.remove-fragrance') as HTMLButtonElement;

    if (addBtn) {
      addBtn.addEventListener('click', () => addFragranceInput());
    }

    if (calculateBtn) {
      calculateBtn.addEventListener('click', calculateRecipe);
    }

    if (waxTypeSelect) {
      waxTypeSelect.addEventListener('change', updateWaxProperties);
    }

    if (recipePresetsSelect) {
      recipePresetsSelect.addEventListener('change', loadRecipePreset);
    }

    // Add event listeners for container type and quantity
    if (containerTypeSelect) {
      containerTypeSelect.addEventListener('change', updateWaterCapacity);
    }

    if (containerQuantityInput) {
      containerQuantityInput.addEventListener('input', updateWaterCapacity);
    }

    // Add auto-calculation on input changes
    if (waxGravityInput) {
      waxGravityInput.addEventListener('input', calculateRecipe);
    }

    if (scentLoadInput) {
      scentLoadInput.addEventListener('input', calculateRecipe);
    }

    if (initialPercentageInput) {
      initialPercentageInput.addEventListener('input', updateTotalPercentage);
    }

    if (initialRemoveBtn) {
      initialRemoveBtn.addEventListener('click', (e) => {
        const target = e.target as HTMLElement;
        target.closest('.fragrance-input')?.remove();
        updateFragranceNumbers();
        updateTotalPercentage();
      });
    }

    // Add event listeners for all percentage inputs
    document.addEventListener('input', (e) => {
      const target = e.target as HTMLElement;
      if (target.classList.contains('fragrance-percentage')) {
        updateTotalPercentage();
      }
    });

    updateFragranceNumbers();
    updateWaxProperties();
    updateWaterCapacity(); // Initialize water capacity display
    
    // Initialize mobile-friendly tooltips
    initializeTooltips();
  });

  // Mobile-friendly tooltip system
  function initializeTooltips(): void {
    const tooltipTriggers = document.querySelectorAll('.tooltip-trigger');
    let activeTooltip: HTMLElement | null = null;

    tooltipTriggers.forEach((trigger) => {
      const tooltipText = trigger.getAttribute('data-tooltip');
      if (!tooltipText) return;

      // Create tooltip element
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip-popup absolute z-50 bg-gray-800 text-white text-xs rounded px-2 py-1 max-w-xs hidden';
      tooltip.textContent = tooltipText;
      document.body.appendChild(tooltip);

      // Show tooltip on click/touch (mobile friendly)
      const showTooltip = (e: Event) => {
        e.preventDefault();
        e.stopPropagation();
        
        // Hide any existing tooltip
        if (activeTooltip && activeTooltip !== tooltip) {
          activeTooltip.classList.add('hidden');
        }
        
        const rect = (trigger as HTMLElement).getBoundingClientRect();
        tooltip.style.left = `${rect.left + window.scrollX}px`;
        tooltip.style.top = `${rect.bottom + window.scrollY + 5}px`;
        
        tooltip.classList.toggle('hidden');
        activeTooltip = tooltip.classList.contains('hidden') ? null : tooltip;
      };

      // Hide tooltip when clicking elsewhere
      const hideTooltip = () => {
        tooltip.classList.add('hidden');
        if (activeTooltip === tooltip) {
          activeTooltip = null;
        }
      };

      // Add event listeners for both touch and mouse
      trigger.addEventListener('click', showTooltip);
      trigger.addEventListener('touchstart', showTooltip);
      
      // Hide on hover out for desktop
      trigger.addEventListener('mouseleave', () => {
        setTimeout(hideTooltip, 100);
      });
    });

    // Hide tooltips when clicking elsewhere
    document.addEventListener('click', (e) => {
      if (activeTooltip && !(e.target as HTMLElement)?.closest('.tooltip-trigger')) {
        activeTooltip.classList.add('hidden');
        activeTooltip = null;
      }
    });
  }
</script>

<style>
  .fragrance-input {
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  input:focus, select:focus {
    box-shadow: 0 0 0 3px rgba(165, 183, 155, 0.1);
  }

  .bg-gradient-to-r {
    background-image: linear-gradient(to right, var(--tw-gradient-stops));
  }
</style> 